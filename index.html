<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sudoku</title>
    <style>
        :root {
            --bg-color: #f0f2f5;
            --board-bg: #ffffff;
            --primary: #007AFF; /* iOS Blue */
            --selection: #d4e8ff;
            --fixed-text: #000000;
            --user-text: #007AFF;
            --border-color: #8e8e93;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            user-select: none; /* Prevent text selection */
            -webkit-user-select: none;
        }

        h1 { margin-bottom: 10px; font-weight: 600; color: #333; }

        /* Game Board */
        #game-board {
            display: grid;
            grid-template-columns: repeat(9, 1fr);
            width: 90vw;
            max-width: 400px;
            aspect-ratio: 1;
            background: var(--board-bg);
            border: 2px solid #000;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border-radius: 8px;
            overflow: hidden;
        }

        .cell {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            border-right: 1px solid #ddd;
            border-bottom: 1px solid #ddd;
            cursor: pointer;
            transition: background 0.1s;
        }

        /* Thicker borders for 3x3 boxes */
        .cell:nth-child(3n) { border-right: 2px solid #333; }
        .cell:nth-child(9n) { border-right: none; } /* End of row */
        .cell:nth-child(n+19):nth-child(-n+27),
        .cell:nth-child(n+46):nth-child(-n+54) { border-bottom: 2px solid #333; }
        .cell:nth-child(n+73) { border-bottom: none; }

        .cell.fixed { font-weight: bold; color: var(--fixed-text); background-color: #fafafa; }
        .cell.user-input { color: var(--user-text); font-weight: 500; }
        .cell.selected { background-color: var(--selection) !important; }
        .cell.error { background-color: #ffcccc !important; color: #d00; }
        .cell.highlight { background-color: #eef4fb; } /* Same number highlight */

        /* Controls */
        #controls {
            margin-top: 20px;
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            width: 90vw;
            max-width: 400px;
        }

        .btn {
            background: #fff;
            border: none;
            border-radius: 10px;
            padding: 15px 0;
            font-size: 1.5rem;
            color: var(--primary);
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            active: scale(0.95);
            cursor: pointer;
        }
        .btn:active { background-color: #eee; transform: scale(0.95); }
        .btn-clear { color: #ff3b30; font-weight: bold; }
        .btn-new { grid-column: span 5; background-color: var(--primary); color: white; font-size: 1rem; padding: 12px; margin-top: 10px; }

        /* Win Overlay */
        #message {
            position: fixed;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255,255,255,0.95);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            text-align: center;
            display: none;
            z-index: 10;
        }
        #message h2 { margin: 0 0 10px; color: var(--primary); }
    </style>
</head>
<body>

    <h1>Sudoku</h1>
    <div id="game-board"></div>

    <div id="controls">
        <button class="btn" onclick="inputNum(1)">1</button>
        <button class="btn" onclick="inputNum(2)">2</button>
        <button class="btn" onclick="inputNum(3)">3</button>
        <button class="btn" onclick="inputNum(4)">4</button>
        <button class="btn" onclick="inputNum(5)">5</button>
        <button class="btn" onclick="inputNum(6)">6</button>
        <button class="btn" onclick="inputNum(7)">7</button>
        <button class="btn" onclick="inputNum(8)">8</button>
        <button class="btn" onclick="inputNum(9)">9</button>
        <button class="btn btn-clear" onclick="inputNum(0)">âŒ«</button>
        <button class="btn btn-new" onclick="newGame()">New Game</button>
    </div>

    <div id="message">
        <h2>You Win! ðŸŽ‰</h2>
        <p>Great job!</p>
        <button class="btn btn-new" style="width:100%" onclick="closeMsg(); newGame()">Play Again</button>
    </div>

    <script>
        let board = [];
        let solution = [];
        let fixed = [];
        let selectedCell = null; // {r, c}

        const boardEl = document.getElementById('game-board');

        // --- Core Logic ---
        function isValid(grid, r, c, k) {
            for (let i = 0; i < 9; i++) {
                if (grid[i][c] === k || grid[r][i] === k) return false;
                const boxR = 3 * Math.floor(r/3) + Math.floor(i/3);
                const boxC = 3 * Math.floor(c/3) + i % 3;
                if (grid[boxR][boxC] === k) return false;
            }
            return true;
        }

        function generateSolution(grid) {
            for (let r = 0; r < 9; r++) {
                for (let c = 0; c < 9; c++) {
                    if (grid[r][c] === 0) {
                        let nums = [1,2,3,4,5,6,7,8,9].sort(() => Math.random() - 0.5);
                        for (let k of nums) {
                            if (isValid(grid, r, c, k)) {
                                grid[r][c] = k;
                                if (generateSolution(grid)) return true;
                                grid[r][c] = 0;
                            }
                        }
                        return false;
                    }
                }
            }
            return true;
        }

        function newGame() {
            // 1. Create Empty
            board = Array.from({length: 9}, () => Array(9).fill(0));
            fixed = Array.from({length: 9}, () => Array(9).fill(false));
            
            // 2. Generate Full Solution
            generateSolution(board);
            solution = board.map(row => [...row]); // Copy solution

            // 3. Punch Holes (Difficulty: Leave ~35 numbers)
            let attempts = 45; 
            while (attempts > 0) {
                let r = Math.floor(Math.random() * 9);
                let c = Math.floor(Math.random() * 9);
                if (board[r][c] !== 0) {
                    board[r][c] = 0;
                    attempts--;
                }
            }

            // 4. Mark Fixed Cells
            for(let r=0; r<9; r++){
                for(let c=0; c<9; c++){
                    if(board[r][c] !== 0) fixed[r][c] = true;
                }
            }

            renderBoard();
            closeMsg();
        }

        // --- UI Functions ---
        function renderBoard() {
            boardEl.innerHTML = '';
            for (let r = 0; r < 9; r++) {
                for (let c = 0; c < 9; c++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    if (fixed[r][c]) cell.classList.add('fixed');
                    else if (board[r][c] !== 0) cell.classList.add('user-input');
                    
                    cell.innerText = board[r][c] === 0 ? '' : board[r][c];
                    
                    // Click Event
                    cell.onclick = () => selectCell(r, c, cell);
                    boardEl.appendChild(cell);
                }
            }
        }

        function selectCell(r, c, el) {
            // Remove previous selection
            document.querySelectorAll('.cell.selected').forEach(c => c.classList.remove('selected'));
            document.querySelectorAll('.cell.highlight').forEach(c => c.classList.remove('highlight'));

            selectedCell = {r, c};
            el.classList.add('selected');

            // Highlight all instances of this number
            const val = board[r][c];
            if (val !== 0) {
                const cells = document.querySelectorAll('.cell');
                cells.forEach((cell, idx) => {
                    const i = Math.floor(idx / 9);
                    const j = idx % 9;
                    if (board[i][j] === val) cell.classList.add('highlight');
                });
            }
        }

        function inputNum(num) {
            if (!selectedCell) return;
            const {r, c} = selectedCell;

            if (fixed[r][c]) return; // Cannot edit fixed cells

            board[r][c] = num;
            
            // Update UI directly
            const index = r * 9 + c;
            const cell = boardEl.children[index];
            cell.innerText = num === 0 ? '' : num;
            
            // Visual feedback
            cell.classList.remove('user-input', 'error');
            if (num !== 0) {
                cell.classList.add('user-input');
                // Check for immediate conflict
                if (!isValidMove(r, c, num)) {
                    cell.classList.add('error');
                }
            }
            
            checkWin();
        }

        function isValidMove(r, c, k) {
            // A relaxed valid check that ignores the cell itself
            for (let i = 0; i < 9; i++) {
                if (i !== c && board[r][i] === k) return false;
                if (i !== r && board[i][c] === k) return false;
            }
            const boxR = 3 * Math.floor(r/3);
            const boxC = 3 * Math.floor(c/3);
            for (let i = 0; i < 3; i++) {
                for (let j = 0; j < 3; j++) {
                    if ((boxR+i !== r || boxC+j !== c) && board[boxR+i][boxC+j] === k) return false;
                }
            }
            return true;
        }

        function checkWin() {
            // Simple check: Board full + No Errors + Matches Solution
            let isFull = true;
            let isCorrect = true;
            for(let r=0; r<9; r++){
                for(let c=0; c<9; c++){
                    if(board[r][c] === 0) isFull = false;
                    if(board[r][c] !== solution[r][c]) isCorrect = false;
                }
            }
            
            if (isFull && isCorrect) {
                document.getElementById('message').style.display = 'block';
            }
        }

        function closeMsg() {
            document.getElementById('message').style.display = 'none';
        }

        // Initialize
        newGame();

    </script>
</body>
</html>